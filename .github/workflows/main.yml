name: Ubuntu XFCE GUI in Browser

on: [workflow_dispatch]

jobs:
  run-gui:
    runs-on: ubuntu-latest

    steps:
    - name: Start XFCE Docker
      run: |
        docker run -d \
          --name ubuntu-gui \
          -p 6901:6901 \
          accetto/ubuntu-vnc-xfce-g3

    - name: Install LocalXpose
      run: |
        wget -O loclx.deb https://api.localxpose.io/api/downloads/loclx-linux-amd64.deb
        sudo dpkg -i loclx.deb
        loclx version

    - name: Auth LocalXpose
      env:
        LOCX_AUTH_TOKEN: DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ
      run: |
        loclx auth $LOCX_AUTH_TOKEN

    - name: Expose GUI on Web via LocalXpose
      run: |
        nohup loclx tunnel http --port 6901 --subdomain xfce-$RANDOM > loclx.log 2>&1 &
        sleep 10
        grep -o 'https://[^ ]*' loclx.log || echo "Tunnel not found"
