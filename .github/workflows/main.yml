name: Ubuntu XFCE + Kdenlive + LocalXpose

on: [workflow_dispatch]

jobs:
  run-vnc:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup Docker
      run: |
        sudo apt update
        sudo apt install docker.io -y
        sudo systemctl start docker
        sudo systemctl enable docker

    - name: Run Ubuntu XFCE Container
      run: |
        docker run -d --name ubuntu-xfce \
          -p 6901:6901 \
          accetto/ubuntu-vnc-xfce-g3

    - name: Install LocalXpose
      run: |
        curl -L "https://api.localxpose.io/api/downloads/loclx-linux-amd64.deb" -o loclx.deb
        sudo dpkg -i loclx.deb
        loclx version

    - name: Authenticate LocalXpose
      run: |
        loclx auth DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ

    - name: Tunnel VNC Port with LocalXpose
      run: |
        nohup loclx tunnel tcp --port 6901 > tunnel.log 2>&1 &
        sleep 15
        cat tunnel.log

    - name: Wait Forever
      run: sleep 3600
