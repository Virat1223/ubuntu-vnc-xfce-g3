name: Browser Ubuntu XFCE GUI with Video Editor

on:
  workflow_dispatch:

jobs:
  run-desktop:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install packages
        run: |
          sudo apt update
          sudo apt install -y xfce4 xfce4-goodies tightvncserver wget curl git software-properties-common

      - name: Setup VNC password
        run: |
          mkdir -p ~/.vnc
          echo -e "passw0rd\npassw0rd\nn" | vncpasswd
          chmod 600 ~/.vnc/passwd

      - name: Start VNC server
        run: |
          vncserver :1
          vncserver -kill :1
          echo '#!/bin/bash
          xrdb $HOME/.Xresources
          startxfce4 &' > ~/.vnc/xstartup
          chmod +x ~/.vnc/xstartup
          vncserver :1 -geometry 1280x720

      - name: Download noVNC
        run: |
          git clone https://github.com/novnc/noVNC.git
          git clone https://github.com/novnc/websockify noVNC/utils/websockify

      - name: Start noVNC
        run: |
          nohup ./noVNC/utils/novnc_proxy --vnc localhost:5901 --listen 6080 &

      - name: Install LocalXpose tunnel
        run: |
          wget https://api.localxpose.io/api/v2/downloads/lx-linux-amd64.zip
          unzip lx-linux-amd64.zip
          chmod +x lx

      - name: Start LocalXpose tunnel (Port 6080)
        run: |
          ./lx tunnel http --port 6080 --auth="DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ"
