name: Ubuntu GUI with LocalXpose

on: [workflow_dispatch]

jobs:
  ubuntu-gui:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: ğŸ› ï¸ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ³ Start Ubuntu XFCE Desktop Container
        run: |
          docker run -d \
            --name ubuntu-desktop \
            -p 6080:80 \
            accetto/ubuntu-vnc-xfce-g3

      - name: ğŸ›°ï¸ Install LocalXpose
        run: |
          sudo apt update
          wget https://api.localxpose.io/api/downloads/loclx-linux-amd64.deb
          sudo dpkg -i loclx-linux-amd64.deb || sudo apt --fix-broken install -y

      - name: ğŸ” Authenticate LocalXpose
        run: |
          ./loclx authtoken DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ

      - name: ğŸŒ Start Tunnel on Port 6080
        run: |
          ./loclx tunnel http --port 6080 &
          sleep 5
          echo "ğŸŒ Tunnel started. Access details will be printed above."

      - name: â³ Keep workflow alive
        run: sleep infinity
