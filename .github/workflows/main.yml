name: Ubuntu XFCE GUI with LocalXpose

on:
  workflow_dispatch:

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ§± Set up Docker
      run: |
        sudo apt-get update
        sudo apt-get install -y docker.io

    - name: ðŸ§ Pull XFCE GUI Docker image
      run: |
        docker pull accetto/ubuntu-vnc-xfce-g3

    - name: ðŸš€ Run XFCE container with exposed VNC (port 6080)
      run: |
        docker run -d -p 6080:6080 --name xfce-gui accetto/ubuntu-vnc-xfce-g3

    - name: ðŸŒ Install LocalXpose
      run: |
        curl -s https://api.localxpose.io/api/v2/downloads/localxpose_24.9.2_linux_amd64.deb --output loclx.deb
        sudo dpkg -i loclx.deb
        mkdir -p ~/.config/localxpose

    - name: ðŸ” Authenticate LocalXpose
      run: |
        echo "${{ secrets.LOCALXPOSE_TOKEN }}" > ~/.config/localxpose/access.token

    - name: ðŸ›œ Start tunnel to expose port 6080
      run: |
        nohup loclx tunnel http --to 127.0.0.1:6080 > tunnel.log 2>&1 &
        sleep 5
        cat tunnel.log

    - name: ðŸ§¾ Show tunnel logs with access link
      run: cat tunnel.log
