name: Ubuntu GUI in Browser with noVNC + LocalXpose

on:
  workflow_dispatch:

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Update & Install GUI, Tools, and noVNC
        run: |
          sudo apt update
          sudo apt install -y xfce4 xfce4-goodies tightvncserver novnc websockify kdenlive firefox curl expect

      - name: Set VNC Password (non-interactive)
        run: |
          mkdir -p ~/.vnc

          expect <<EOF
          spawn vncpasswd
          expect "Password:"
          send "kali1234\r"
          expect "Verify:"
          send "kali1234\r"
          expect eof
          EOF

          chmod 600 ~/.vnc/passwd

      - name: Start VNC Server
        run: |
          vncserver :1 -geometry 1280x720 -depth 24

      - name: Start noVNC Server
        run: |
          websockify --web=/usr/share/novnc/ 6080 localhost:5901 &
          sleep 3
          echo "âœ… noVNC running on port 6080"

      - name: Expose GUI with LocalXpose
        run: |
          curl -s https://raw.githubusercontent.com/localxpose/cli/main/install.sh | bash
          ./lx tunnel http --port 6080 --to 80 --subdomain ubuntu-gui
