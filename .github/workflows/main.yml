name: Ubuntu GUI in Browser (LocalXpose)

on:
  workflow_dispatch:

jobs:
  ubuntu-gui:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Docker
        uses: docker/setup-buildx-action@v3

      - name: Run Ubuntu XFCE Desktop (noVNC)
        run: |
          docker run -d --name ubuntu-desktop \
            -p 6080:6080 \
            accetto/ubuntu-vnc-xfce-g3

      - name: Install LocalXpose CLI
        run: |
          wget https://localxpose.io/releases/loclx-linux-amd64.deb
          sudo dpkg -i loclx-linux-amd64.deb || sudo apt --fix-broken install -y

      - name: Login to LocalXpose
        run: |
          mkdir -p ~/.config/localxpose
          echo 'auth_token: DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ' > ~/.config/localxpose/config.yml

      - name: Start tunnel to noVNC
        run: |
          nohup loclx tunnel http --to 127.0.0.1:6080 > tunnel.log 2>&1 &
          sleep 5
          cat tunnel.log | grep -i "https"

      - name: Show tunnel URL
        run: |
          echo "ğŸ‘‡ğŸ‘‡ğŸ‘‡ COPY YOUR LINK ğŸ‘‡ğŸ‘‡ğŸ‘‡"
          cat tunnel.log | grep -i "https" || echo "Wait a bit then check again in logs"

      - name: Keep Action Alive
        run: sleep 3600
