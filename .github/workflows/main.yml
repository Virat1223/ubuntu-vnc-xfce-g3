name: Cloud Ubuntu Desktop with XFCE

on:
  workflow_dispatch:

jobs:
  run-vnc:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: Pull XFCE Ubuntu VNC Image
        run: |
          docker pull accetto/ubuntu-vnc-xfce-g3

      - name: Run Ubuntu Desktop container
        run: |
          docker run -d --name ubuntu-gui -p 6080:6080 accetto/ubuntu-vnc-xfce-g3

      - name: Install LocalXpose
        run: |
          wget https://api.localxpose.io/api/downloads/loclx-linux-amd64.deb -O loclx.deb
          sudo dpkg -i loclx.deb
          mkdir -p ~/.config/localxpose
          echo '${{ secrets.LOCALXPOSE_TOKEN }}' > ~/.config/localxpose/access.token

      - name: Start LocalXpose tunnel to port 6080
        run: |
          loclx tunnel http --to 127.0.0.1:6080 > tunnel.log 2>&1 &
          sleep 5
          cat tunnel.log
