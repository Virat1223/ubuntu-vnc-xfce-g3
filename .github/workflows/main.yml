name: Ubuntu GUI in Browser with noVNC

on:
  workflow_dispatch:

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Set up Ubuntu Desktop with XFCE, Kdenlive, noVNC
        run: |
          sudo apt update
          sudo apt install -y xfce4 xfce4-goodies tightvncserver novnc websockify kdenlive firefox

          mkdir -p ~/.vnc
          # Set password for VNC (needs expect to automate)
          sudo apt install -y expect
          expect <<EOF
          spawn vncpasswd
          expect "Password:"
          send "kali123\r"
          expect "Verify:"
          send "kali123\r"
          expect eof
          EOF

          export DISPLAY=:1
          vncserver $DISPLAY -geometry 1280x720 -depth 24

          # Start noVNC server
          nohup websockify --web=/usr/share/novnc/ 6080 localhost:5901 &

      - name: Serve noVNC via LocalXpose
        run: |
          curl -s https://raw.githubusercontent.com/localxpose/cli/main/install.sh | bash
          ./lx tunnel http --port 6080 --subdomain ubuntu-gui
