name: Ubuntu XFCE VNC in Browser

on: [workflow_dispatch]

jobs:
  vnc:
    runs-on: ubuntu-latest
    name: Start XFCE Desktop with LocalXpose
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Set up Docker
        uses: docker/setup-buildx-action@v3

      - name: Pull XFCE Docker Image
        run: docker pull accetto/ubuntu-vnc-xfce-g3

      - name: Run XFCE Container
        run: |
          docker run -d \
            --name xfce-desktop \
            -p 6901:6901 \
            accetto/ubuntu-vnc-xfce-g3

      - name: Download LocalXpose Client
        run: |
          wget https://api.localxpose.io/api/v2/downloads/lx-linux-amd64.zip -O lx.zip
          unzip lx.zip
          chmod +x lx
          ./lx authtoken DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ
          nohup ./lx tunnel http --port 6901 --https > tunnel.log 2>&1 &

      - name: Wait and Print Tunnel Log
        run: |
          sleep 10
          cat tunnel.log || true
