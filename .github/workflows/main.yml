name: Ubuntu XFCE Desktop with noVNC + Kdenlive + LocalXpose

on:
  workflow_dispatch:

jobs:
  run-desktop:
    runs-on: ubuntu-latest

    steps:
    - name: Setup Docker
      run: |
        sudo apt update
        sudo apt install docker.io -y

    - name: Pull Desktop Image
      run: |
        docker pull accetto/ubuntu-vnc-xfce-g3

    - name: Run Desktop with Tools
      run: |
        docker run -d \
          --name vnc-desktop \
          -p 6080:6080 \
          accetto/ubuntu-vnc-xfce-g3 \
          /bin/bash -c "apt update && apt install -y kdenlive gimp && startvnc"

    - name: Install LocalXpose
      run: |
        curl -s https://api.localxpose.io/api/v2/downloads/linux/amd64 -o lx
        chmod +x lx
        ./lx authtoken DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ

    - name: Start LocalXpose Tunnel (Port 6080)
      run: |
        nohup ./lx http 6080 > tunnel.log 2>&1 &
        sleep 5
        cat tunnel.log | grep -i "url"

    - name: Show Access URL
      run: |
        echo "ðŸ”— Visit your XFCE desktop in browser:"
        cat tunnel.log | grep -oE "https://[a-zA-Z0-9.-]+\.loca\.lt"
