name: Simple Ubuntu XFCE GUI via noVNC + LocalXpose

on:
  workflow_dispatch:

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-latest

    steps:
    - name: Install XFCE and VNC
      run: |
        sudo apt update
        sudo apt install -y xfce4 xfce4-goodies tightvncserver wget curl git

    - name: Set up VNC Password
      run: |
        mkdir -p ~/.vnc
        echo "pass1234" | vncpasswd -f > ~/.vnc/passwd
        chmod 600 ~/.vnc/passwd

    - name: Start VNC Server
      run: vncserver :1 -geometry 1280x720 -depth 24

    - name: Set up noVNC
      run: |
        git clone https://github.com/novnc/noVNC.git
        cd noVNC
        git clone https://github.com/novnc/websockify
        nohup ./utils/launch.sh --vnc localhost:5901 > ../novnc.log 2>&1 &

    - name: Install LocalXpose
      run: |
        curl -s https://api.localxpose.io/api/v2/downloads/linux/amd64 -o lx
        chmod +x lx
        ./lx authtoken DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ

    - name: Start LocalXpose Tunnel (Port 6080 for noVNC)
      run: |
        nohup ./lx http 6080 > lx.log 2>&1 &
        sleep 8
        echo "Your public URL (copy this):"
        grep -o 'https://[a-zA-Z0-9.-]*\.loca\.lt' lx.log || cat lx.log
