name: ðŸš€ Cloud Ubuntu Desktop via LocalXpose

on:
  workflow_dispatch:

jobs:
  desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Run Ubuntu XFCE Desktop Container
        run: |
          docker run -d \
            --name ubuntu-desktop \
            -p 6080:6080 \
            accetto/ubuntu-vnc-xfce-g3

      - name: Wait for XFCE desktop services
        run: sleep 15

      - name: Download LocalXpose CLI
        run: |
          wget -O lx.zip https://github.com/localxpose/localxpose/releases/download/v2.0.3/loclx-linux-amd64.zip
          unzip lx.zip
          chmod +x loclx
          rm lx.zip

      - name: Start LocalXpose Tunnel
        run: |
          ./loclx tunnel http --to 127.0.0.1:6080 --token ${{ secrets.LOCALXPOSE_TOKEN }}

      - name: Get Tunnel URL
        run: |
          echo "Tunnel established at: $(./loclx tunnel list --token ${{ secrets.LOCALXPOSE_TOKEN }} | grep URL | awk '{print $2}')"
