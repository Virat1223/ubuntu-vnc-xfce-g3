name: Ubuntu XFCE Desktop with LocalXpose

on: [workflow_dispatch]

jobs:
  desktop:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up Ubuntu VNC Desktop
      run: |
        docker run -d \
          --name ubuntu-desktop \
          -p 5901:5901 \
          -p 6901:6901 \
          accetto/ubuntu-vnc-xfce-g3

    - name: Download and install LocalXpose
      run: |
        wget -O loclx.deb https://api.localxpose.io/api/downloads/loclx-linux-amd64.deb
        sudo dpkg -i loclx.deb || sudo apt --fix-broken install -y
        loclx authtoken DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ

    - name: Start LocalXpose tunnel to port 6901 (noVNC)
      run: |
        nohup loclx tunnel http --port 6901 --subdomain myxfce123 &

    - name: Keep GitHub Actions runner alive
      run: |
        echo "Runner active. Press Ctrl+C to stop." 
        tail -f /dev/null
