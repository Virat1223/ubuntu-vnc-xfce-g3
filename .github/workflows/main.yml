name: Ubuntu XFCE Desktop with LocalXpose (noVNC Access)

on:
  workflow_dispatch:

jobs:
  start-desktop:
    runs-on: ubuntu-latest

    steps:
    - name: 🧱 Set up environment
      run: |
        sudo apt update
        sudo apt install -y docker.io curl unzip

    - name: 🔐 Set LocalXpose Auth Token
      run: |
        curl -s https://localxpose.io/get/linux -o lx
        chmod +x lx
        ./lx authtoken DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ

    - name: 🚀 Launch Docker Desktop (accetto/ubuntu-vnc-xfce-g3)
      run: |
        docker run -d \
          -p 5901:5901 \
          -p 6901:6901 \
          -e VNC_PW='vir@at123' \
          --name xfce-desktop \
          accetto/ubuntu-vnc-xfce-g3

    - name: 🌐 Expose noVNC (port 6901) via LocalXpose
      run: |
        nohup ./lx tunnel http --port 6901 --region ap > lxlog.txt 2>&1 &

    - name: 💤 Wait for tunnel to initialize
      run: sleep 10

    - name: 📡 Show noVNC Public URL
      run: |
        cat lxlog.txt | grep -i "https://" || echo "Tunnel not started. Check token or region."
