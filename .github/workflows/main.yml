name: Ubuntu GUI with Browser Access

on: [workflow_dispatch]

jobs:
  ubuntu-desktop:
    runs-on: ubuntu-latest
    steps:
      - name: Launch Ubuntu GUI via Docker (noVNC on :6080)
        run: |
          docker run -d \
            -p 6080:80 \
            -e VNC_PW='longsecurepass' \
            --name ubuntu-desktop \
            accetto/ubuntu-vnc-xfce-g3

      - name: Install dependencies
        run: sudo apt update && sudo apt install -y wget curl gdebi-core

      - name: Download and install LocalXpose
        run: |
          wget -O loclx.deb https://api.localxpose.io/api/downloads/loclx-linux-amd64.deb
          sudo gdebi -n loclx.deb

      - name: Authenticate LocalXpose
        run: loclx login --token DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ

      - name: Start LocalXpose tunnel and keep alive
        run: |
          loclx tunnel http --to 127.0.0.1:6080 > tunnel.log 2>&1 &
          echo "Tunnel started. Waiting..."
          tail -f /dev/null
