name: Ubuntu XFCE Desktop with noVNC

on: [push]

jobs:
  run-desktop:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: Build Desktop Image
        run: |
          docker run -d \
            -p 6080:80 \
            --name ubuntu-vnc \
            accetto/ubuntu-vnc-xfce-g3

      - name: Download LocalXpose CLI
        run: |
          curl -s https://api.localxpose.io/api/v2/downloads/loclx-linux-amd64 -o loclx
          chmod +x loclx
          mv loclx ~/loclx

      - name: Start LocalXpose Tunnel
        run: |
          cd ~
          ./loclx authtoken DgN6KiykIQ1cb7XvcoaYz2AXX68yIwvUndjYfchQ
          ./loclx tunnel http --to 127.0.0.1:6080 > tunnel.log 2>&1 &
          sleep 5
          tail tunnel.log
